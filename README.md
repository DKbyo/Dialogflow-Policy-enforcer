# Dialogflow-Policy-enforcer
Used to enforce Dialogflow CX configuration policies:

Policy 1: Dialogflow CX Agent logging policy is to enable agent logs
Policy 2. Dialogflow's webhooks cannot include static credentials (username/password)

Overall enforcer flow:

Dialogflow audit logs -> Cloud router sink -> Pub/Sub -> Cloud Functions -> Apply policies

Configuration steps:

1. Enable Audit logs enabled for Dialoglow API.

2. Create org-level Cloud log router/log-sink sending to pub/sub topic.
   * Logs included on filter:

       protoPayload.serviceName="dialogflow.googleapis.com" AND 
       (Webhooks.CreateWebhook OR
       Webhooks.UpdateWebhook OR 
       Agents.CreateAgent OR 
       Agents.UpdateAgent)

   * Exclude the logs generated by Cloud Functions' service account, by default:
       protoPayload.authenticationInfo.principalEmail="project-id@appspot.gserviceaccount.com"

   * Make sure to grant Publisher permissions to the logging service account.

3. Create Cloud Function as a subscription of the Pub/sub topic. 

5. Implement Cloud function with main.py code